<!-- <div>{{ appState2$ | async | json }}}</div> -->

<div class="container-xl">
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand">Manager Server</a>
            <li class="nav-item d-flex">
                <button class="m-1 btn btn-success" type="button" (click)="open(createModal)" data-bs-toggle="modal"
                    data-bs-target="#createModal">CREATE</button>
                <button class="m-1 btn btn-success" type="button" (click)="filter(Status.ALL)">ALL</button>
                <button class="m-1 btn btn-success" type="button" (click)="filter(Status.SERVER_UP)">SERVER UP</button>
                <button class="m-1 btn btn-primary" type="button" (click)="filter(Status.SERVER_DOWN)">SERVER DOWN</button>
            </li>
        </div>
    </nav>
    <ng-container *ngIf="(appState$ | async) as appState" [ngSwitch]="appState.dataState">
        <ng-container *ngSwitchCase="DataState.LOADING_STATE">
            <div class="m-1 d-flex justify-content-center">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden"></span>
                </div>
            </div>
        </ng-container>
        <ng-container *ngSwitchCase="DataState.LOADED_STATE">
            <table class="table table-dark">
                <thead>
                    <tr>
                        <th scope="col">Image</th>
                        <th scope="col">IP Address</th>
                        <th scope="col">Name</th>
                        <th scope="col">Memory</th>
                        <th scope="col">Type</th>
                        <th scope="col">Status</th>
                        <th scope="col">Ping</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody *ngFor="let server of appState.appData.data.servers; let i = index">
                    <td>
                        <img [src]="server.imageUrl" [alt]="server.name" width="40" height="40" />
                    </td>
                    <td>{{server.ipAddress}}</td>
                    <td>{{server.name}}</td>
                    <td>{{server.memory}}</td>
                    <td>{{server.type}}</td>
                    <td>
                        <span class="badge"
                            [ngClass]="server.status == Status.SERVER_UP ? ' badge-success' : ' badge-danger'">
                            {{server.status == Status.SERVER_UP ? 'SERVER UP' : 'SERVER DOWN'}}
                        </span>
                    </td>
                    <td>
                        <button *ngIf="(filterStatus$ | async) === '' || (filterStatus$ | async) !== server.ipAddress"
                            (click)="pingServer(server.ipAddress)" type="button" class="btn btn-primary">Ping</button>
                        <div *ngIf="(filterStatus$ | async) === server.ipAddress" class="d-flex justify-content-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden"></span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <button type="button" class="btn btn-danger">Delete</button>
                    </td>
                </tbody>
            </table>
        </ng-container>
        <ng-container *ngSwitchCase="DataState.ERROR_STATE">
            <div class="alert alert-danger" role="alert">
                {{ appState.error }}
            </div>
        </ng-container>
    </ng-container>
</div>

<ng-template #createModal let-modal>
        <div class="modal-content">
            <form #serverForm="ngForm" (ngSubmit)="saveServer(serverForm)">
                <div class="modal-header">
                    <H4 class="modal-title"> Add Server</H4>
                    <button type="button" class="close">Close</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>IP</label>
                        <input type="text" ngModel name="ipAddress" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" ngModel name="name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <input type="text" ngModel name="type" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select name="status" ngModal="SERVER_DOWN" class="form-control" name="status" required>
                            <option value="SERVER_UP">SERVER UP</option>
                            <option value="SERVER_DOWN">SERVER DOWN</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" id="closeModal" data-dismiss="modal">CANCEL</button>
                    <button type="submit" class="btn btn-success">ADD</button>
                    <span>Saving...</span>
                </div>
            </form>
        </div>
</ng-template>

<app-modal></app-modal>